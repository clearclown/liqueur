# @liqueur/react

React components for rendering Liquid Protocol schemas

## Overview

`@liqueur/react` provides React components that render UI from Liquid Protocol schemas. This library enables dynamic, data-driven UIs generated by AI or defined programmatically.

## Features

- **LiquidRenderer** - Main component for rendering complete schemas
- **Chart components** - Bar, line, and pie charts using Recharts
- **Table components** - Interactive tables with @tanstack/react-table
- **Layout system** - Grid and Stack layouts
- **Data fetching hook** - `useLiquidView` for loading data
- **Dashboard Management** - Hooks and components for managing dashboards
  - `useDashboards` - Fetch and manage dashboard list
  - `useDashboardMutations` - Create, update, delete dashboards
  - `useFavorites` - Favorite management with localStorage
  - `DashboardCard`, `DashboardList`, `DashboardSearch` - UI components
- **Loading states** - Built-in loading indicators
- **Type-safe** - Full TypeScript support

## Installation

```bash
npm install @liqueur/react @liqueur/protocol
```

### Peer Dependencies

```bash
npm install react@^18.0.0
```

## Usage

### Basic Example

```tsx
import { LiquidRenderer } from '@liqueur/react';
import type { LiquidViewSchema } from '@liqueur/protocol';

const schema: LiquidViewSchema = {
  version: '1.0',
  layout: {
    type: 'grid',
    columns: 2,
    gap: 16
  },
  components: [
    {
      type: 'chart',
      variant: 'bar',
      title: 'Monthly Sales',
      data_source: 'sales'
    },
    {
      type: 'table',
      columns: ['month', 'amount'],
      title: 'Sales Data',
      data_source: 'sales'
    }
  ],
  data_sources: {
    sales: {
      resource: 'sales'
    }
  }
};

const data = {
  sales: [
    { month: 'Jan', amount: 1000 },
    { month: 'Feb', amount: 1500 },
    { month: 'Mar', amount: 1200 }
  ]
};

function App() {
  return <LiquidRenderer schema={schema} data={data} />;
}
```

### With Data Fetching Hook

```tsx
import { LiquidRenderer, useLiquidView } from '@liqueur/react';

function App() {
  const { data, loading, error } = useLiquidView({ schema });

  if (error) return <div>Error: {error.message}</div>;

  return <LiquidRenderer schema={schema} data={data} loading={loading} />;
}
```

## Components

### LiquidRenderer

Main component for rendering complete schemas.

**Props:**
- `schema: LiquidViewSchema` - The schema to render
- `data?: Record<string, unknown[]>` - Data mapped by data_source name
- `loading?: boolean` - Show loading indicators
- `className?: string` - CSS class name

### ChartComponent

Renders charts (bar, line, pie).

**Props:**
- `variant: 'bar' | 'line' | 'pie'` - Chart type
- `title?: string` - Chart title
- `data_source?: string` - Data source name
- `data?: unknown[]` - Chart data
- `loading?: boolean` - Loading state
- `width?: number | string` - Chart width
- `height?: number` - Chart height (default: 300)
- `xKey?: string` - X-axis key (default: first key)
- `yKeys?: string[]` - Y-axis keys (default: all numeric keys)

### TableComponent

Renders interactive tables.

**Props:**
- `columns: string[]` - Column names
- `title?: string` - Table title
- `data_source?: string` - Data source name
- `data?: unknown[]` - Table data
- `loading?: boolean` - Loading state

## Hooks

### useLiquidView

Fetches data for a Liquid schema (Phase 1: mock data, Phase 2: API integration).

```typescript
const { data, loading, error } = useLiquidView({ schema });
```

**Parameters:**
- `schema: LiquidViewSchema` - Schema with data_sources

**Returns:**
- `data: Record<string, unknown[]>` - Data mapped by data_source name
- `loading: boolean` - Loading state
- `error: Error | null` - Error if any occurred

### useDashboards

Fetches and manages dashboard list with search, sort, and filter.

```typescript
const { dashboards, isLoading, error, refresh } = useDashboards({
  search: "expenses",
  sort: "created",
  order: "desc",
  favorites: false,
});
```

**Parameters:**
- `search?: string` - Search query (title/description)
- `sort?: 'name' | 'created' | 'updated'` - Sort field
- `order?: 'asc' | 'desc'` - Sort order
- `favorites?: boolean` - Show only favorites

**Returns:**
- `dashboards: Dashboard[]` - Dashboard list
- `isLoading: boolean` - Loading state
- `error: Error | null` - Error if any
- `refresh: () => Promise<void>` - Refresh function
- `total: number` - Total count

### useDashboardMutations

Provides CRUD operations for dashboards.

```typescript
const { createDashboard, updateDashboard, deleteDashboard, isCreating } =
  useDashboardMutations({
    onCreateSuccess: (dashboard) => console.log("Created:", dashboard.id),
  });

// Create
await createDashboard({ title: "New Dashboard", schema: {...} });

// Update
await updateDashboard("dashboard-id", { title: "Updated Title" });

// Delete
await deleteDashboard("dashboard-id");
```

**Returns:**
- `createDashboard: (data) => Promise<Dashboard>` - Create function
- `updateDashboard: (id, data) => Promise<Dashboard>` - Update function
- `deleteDashboard: (id) => Promise<void>` - Delete function
- `isCreating: boolean` - Creating state
- `isUpdating: boolean` - Updating state
- `isDeleting: boolean` - Deleting state

### useFavorites

Manages favorite dashboards with localStorage.

```typescript
const { favorites, toggleFavorite, isFavorite } = useFavorites();

// Toggle favorite
toggleFavorite("dashboard-id");

// Check if favorite
if (isFavorite("dashboard-id")) {
  console.log("This is a favorite!");
}
```

**Returns:**
- `favorites: Set<string>` - Favorite dashboard IDs
- `toggleFavorite: (id: string) => void` - Toggle function
- `isFavorite: (id: string) => boolean` - Check function

## Dashboard Manager Components

### DashboardCard

Displays a dashboard as a card with metadata and actions.

```tsx
<DashboardCard
  dashboard={dashboard}
  onSelect={(d) => console.log("Selected:", d.id)}
  onFavoriteToggle={(id) => console.log("Toggle:", id)}
  onEdit={(d) => console.log("Edit:", d.id)}
  onDelete=(id) => console.log("Delete:", id)}
/>
```

### DashboardList

Displays dashboards in a responsive grid layout.

```tsx
<DashboardList
  dashboards={dashboards}
  isLoading={isLoading}
  error={error}
  onSelect={handleSelect}
  onFavoriteToggle={handleFavoriteToggle}
  onEdit={handleEdit}
  onDelete={handleDelete}
  renderCard={(dashboard) => <CustomCard {...dashboard} />}
/>
```

### DashboardSearch

Provides search, sort, and filter controls.

```tsx
<DashboardSearch
  onSearch={(query) => setSearch(query)}
  onSortChange={(sort) => setSort(sort)}
  onOrderChange={(order) => setOrder(order)}
  onFavoritesToggle={(enabled) => setFavorites(enabled)}
/>
```

### Complete Example

```tsx
import {
  DashboardList,
  DashboardSearch,
  useDashboards,
  useDashboardMutations,
  useFavorites,
} from '@liqueur/react';

function DashboardManager() {
  const [search, setSearch] = useState('');
  const [sort, setSort] = useState<'name' | 'created' | 'updated'>('created');
  const [order, setOrder] = useState<'asc' | 'desc'>('desc');
  const [favoritesOnly, setFavoritesOnly] = useState(false);

  const { dashboards, isLoading, error } = useDashboards({
    search,
    sort,
    order,
    favorites: favoritesOnly,
  });

  const { deleteDashboard } = useDashboardMutations();
  const { toggleFavorite } = useFavorites();

  return (
    <>
      <DashboardSearch
        onSearch={setSearch}
        onSortChange={setSort}
        onOrderChange={setOrder}
        onFavoritesToggle={setFavoritesOnly}
      />

      <DashboardList
        dashboards={dashboards}
        isLoading={isLoading}
        error={error}
        onSelect={(dashboard) => console.log("Selected:", dashboard)}
        onFavoriteToggle={toggleFavorite}
        onEdit={(dashboard) => console.log("Edit:", dashboard)}
        onDelete={deleteDashboard}
      />
    </>
  );
}
```

## Layouts

### GridLayout

CSS Grid-based responsive layout.

```tsx
<GridLayout columns={2} gap={16}>
  {children}
</GridLayout>
```

### StackLayout

Vertical stacking layout.

```tsx
<StackLayout gap={16}>
  {children}
</StackLayout>
```

## Development

```bash
# Build
npm run build

# Test
npm test

# Test with coverage
npm run test:coverage

# Lint
npm run lint

# Type check
npm run typecheck
```

## Contributing

See the main [repository](https://github.com/ablaze/liqueur) for contribution guidelines.

## License

MIT
